<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>P_eq Screening Tool (GitHub Hybrid)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    /* --- CSS Styles --- */
    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #eef2f3; padding: 20px; text-align: center; color: #333; }
    
    .container { width: 100%; max-width: 210mm; margin: 0 auto; background: white; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid #2c3e50; min-height: 800px; }
    h1 { color: #2c3e50; font-size: 20px; text-transform: uppercase; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
    h3 { margin: 0 0 10px 0; font-size: 12px; color: #444; text-transform: uppercase; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; font-weight: bold; }

    /* Panels Layout */
    .control-panel { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; text-align: left; }
    .panels-row { display: flex; gap: 10px; }
    .panel { flex: 1; padding: 8px; border-radius: 6px; font-size: 11px; display: flex; flex-direction: column; }
    
    /* Colors */
    .panel-geo { background: #e8f8f5; border: 1px solid #a2d9ce; }
    .panel-net { background: #ebf5fb; border: 1px solid #aed6f1; }
    .panel-stream { background: #f4ecf7; border: 1px solid #d2b4de; }
    .panel-rain { background: #fff3cd; border: 1px solid #ffeeba; }

    /* Inputs */
    .form-group { display: flex; align-items: center; margin-bottom: 6px; gap: 4px; }
    .form-group label { flex: 0 0 130px; font-weight: 600; }
    .form-group input, .form-group select { flex: 1; height: 28px; text-align: center; border: 1px solid #ccc; border-radius: 4px; font-weight: bold; }

    /* Side Panel (GitHub List) */
    #basinPanel {
      position: fixed; top: 10px; left: 10px; width: 360px; max-height: 90vh; overflow-y: auto;
      background: white; z-index: 9000; box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 8px; font-size: 11px;
      border: 1px solid #ccc;
    }
    .bp-head { background: #2c3e50; color: white; padding: 8px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
    .bp-subhead { background: #f4f6f7; padding: 5px; border-bottom: 1px solid #ddd; font-weight: bold; color: #555; }
    
    table { width: 100%; border-collapse: collapse; font-size: 10px; }
    th { background: #34495e; color: white; padding: 6px; position: sticky; top: 0; }
    td { border-bottom: 1px solid #eee; padding: 4px; text-align: center; }
    tr:hover { background: #f9f9f9; }

    /* Buttons */
    .mini-btn { padding: 2px 6px; font-size: 10px; border-radius: 3px; cursor: pointer; border: none; color: white; margin-left: 2px; }
    .btn-load { background: #2980b9; }
    .btn-map { background: #27ae60; }
    .btn-web { background: #e67e22; }
    .btn-gray { background: #95a5a6; }

    /* Map Modal */
    #mapModal { display: none; position: fixed; inset: 20px; background: white; border: 1px solid #ccc; z-index: 10000; box-shadow: 0 0 25px rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; display: flex; flex-direction: column; }
    #mapBox { flex: 1; width: 100%; border: 1px solid #ddd; margin-top: 10px; }
    
    /* Summary Box */
    .summary-box { background: #fff; border: 2px dashed #bdc3c7; padding: 10px; margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-around; font-weight: bold; }
    .stat-item span { display: block; font-size: 14px; color: #2c3e50; margin-top: 3px; }

    /* Loader */
    #loader { padding: 10px; background: #eaf2f8; color: #2980b9; font-weight: bold; display: none; text-align: center; }
  </style>
</head>
<body>

<div id="basinPanel">
  <div class="bp-head">
     <span>GitHub Data: <span style="color:#f39c12;">nireas</span></span>
     <button class="mini-btn btn-gray" onclick="togglePanel()">_</button>
  </div>
  <div id="loader">ğŸ”„ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</div>
  
  <div id="basinPanelBody">
    <div style="padding:10px; background:#fcfcfc; border-bottom:2px solid #eee;">
      <h3 style="margin-top:0;">ğŸ“¡ ÎœÎµÏ„ÎµÏ‰ÏÎ¿Î»Î¿Î³Î¹ÎºÎ¿Î¹ Î£Ï„Î±Î¸Î¼Î¿Î¹</h3>
      <div style="display:flex; gap:5px; margin-bottom:5px;">
        <select id="meteoStationSelect" style="flex:1; font-size:11px; padding:4px;">
           <option value="">Î•Ï€Î¹Î»Î¿Î³Î® ÏƒÏ„Î±Î¸Î¼Î¿Ï...</option>
        </select>
        <button class="mini-btn btn-web" onclick="openStationWeb()" title="Î†Î½Î¿Î¹Î³Î¼Î± ÏƒÎµÎ»Î¯Î´Î±Ï‚ ÏƒÏ„Î±Î¸Î¼Î¿Ï">ğŸ”— Web</button>
      </div>
      
      <div style="display:flex; gap:5px; justify-content:space-between;">
          <button class="mini-btn btn-load" style="flex:1; padding:6px;" onclick="fetchStationData()">â¬‡ï¸ Î›Î®ÏˆÎ· (API)</button>
          <button class="mini-btn btn-map" style="flex:1; padding:6px;" onclick="fetchLiveMeteo()">ğŸŒ Open-Meteo</button>
      </div>
      <div id="meteoStatus" style="font-size:9px; color:#666; margin-top:4px; font-style:italic;">Î‘Î½Î±Î¼Î¿Î½Î®...</div>
    </div>

    <div class="bp-subhead">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î›ÎµÎºÎ¬Î½ÎµÏ‚ (.geojson)</div>
    <table>
      <thead><tr><th>Î›ÎµÎºÎ¬Î½Î·</th><th>P<sub>eq</sub></th><th>Î•Î½Î­ÏÎ³ÎµÎ¹Î±</th></tr></thead>
      <tbody id="basinRows"></tbody>
    </table>
    <div style="padding:5px; font-size:9px; color:#777; text-align:left;">
       *Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î±Ï€ÏŒ Ï†Î¬ÎºÎµÎ»Î¿: <b>data/basins/</b>
    </div>
  </div>
</div>

<div class="container">
  <h1 style="display:flex; justify-content:space-between;">
    <span>P<sub>eq</sub> Screening Tool</span>
    <span style="font-size:12px; color:#7f8c8d; font-weight:normal;">vHybrid (Fixed)</span>
  </h1>
  
  <div class="control-panel">
    <div class="panel panel-rain">
      <h3>Î”ÎµÎ´Î¿Î¼Î­Î½Î± Î’ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ·Ï‚</h3>
      <div class="form-group">
        <label>ÎˆÎ½Ï„Î±ÏƒÎ· i (mm/h):</label>
        <input type="number" id="rainI" value="0" step="0.1" oninput="calc()">
      </div>
      <div class="form-group">
        <label>Î”Î¹Î¬ÏÎºÎµÎ¹Î± D (min):</label>
        <input type="number" id="rainD" value="0" oninput="calc()">
      </div>
      <div style="font-size:10px; color:#555; text-align:right;">
         *Î‘Î½ D=0, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ Tc (min 5')
      </div>
    </div>

    <div class="panels-row">
      <div class="panel panel-geo">
         <h3>Î“ÎµÏ‰Î¼ÎµÏ„ÏÎ¯Î± Î›ÎµÎºÎ¬Î½Î·Ï‚</h3>
         <div class="form-group"><label>Î•Î¼Î²Î±Î´ÏŒÎ½ A (mÂ²):</label><input type="number" id="area" value="0" oninput="calc()"></div>
         <div class="form-group"><label>ÎœÎ®ÎºÎ¿Ï‚ L (m):</label><input type="number" id="length" value="0" oninput="calc()"></div>
         <div class="form-group"><label>Î¥ÏˆÏŒÎ¼ÎµÏ„ÏÎ¿ H (m):</label><input type="number" id="height" value="0" oninput="calc()"></div>
         <div class="form-group"><label>Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î®Ï‚ C:</label><input type="number" id="coef" value="0.40" oninput="calc()"></div>
      </div>
      
      <div class="panel panel-stream">
         <h3>Î”Î¹ÏŒÎ´ÎµÏ…ÏƒÎ· / Î‘Î³Ï‰Î³ÏŒÏ‚</h3>
         <div class="form-group"><label>Î Î»Î¬Ï„Î¿Ï‚ b (m):</label><input type="number" id="strWidth" value="0" oninput="calc()"></div>
         <div class="form-group"><label>Î’Î¬Î¸Î¿Ï‚ h (m):</label><input type="number" id="strDepth" value="0" oninput="calc()"></div>
         <div class="form-group"><label>Manning n:</label><input type="number" id="strN" value="0.030" oninput="calc()"></div>
      </div>
    </div>
  </div>

  <div class="summary-box">
     <div class="stat-item">Tc (Kirpich)<span id="res-tc">0.0 min</span></div>
     <div class="stat-item" style="color:#d35400;">Qpeak (Rational)<span id="res-qsel">0.00 mÂ³/s</span></div>
     <div class="stat-item" style="color:#2980b9;">Qcap (Manning)<span id="res-cap">0.00 mÂ³/s</span></div>
     <div class="stat-item">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·<span id="res-status">â€”</span></div>
  </div>

  <div style="font-size:10px; color:#7f8c8d; margin-top:20px;">
    <b>ÎŸÎ´Î·Î³Î¯Î±:</b> Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î»ÎµÎºÎ¬Î½Î· Î±Ï€ÏŒ Ï„Î¿ Î±ÏÎ¹ÏƒÏ„ÎµÏÏŒ Î¼ÎµÎ½Î¿Ï (Load). Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏƒÏ„Î±Î¸Î¼ÏŒ Î® Open-Meteo Î³Î¹Î± Î²ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ·.
  </div>
</div>

<div id="mapModal" style="display:none;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <b>Î ÏÎ¿Î²Î¿Î»Î® Î§Î¬ÏÏ„Î·</b>
    <button class="mini-btn btn-gray" onclick="document.getElementById('mapModal').style.display='none'">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</button>
  </div>
  <div id="mapBox" style="height:400px;"></div>
</div>

<script>
  // --- CONFIG ---
  const GH_USER = 'petrsanidas-ui';
  const GH_REPO = 'nireas';
  const GH_BRANCH = 'main';
  const API_TREE = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/git/trees/${GH_BRANCH}?recursive=1`;
  const RAW_URL = `https://raw.githubusercontent.com/${GH_USER}/${GH_REPO}/${GH_BRANCH}/`;

  let BASINS = [];
  let SELECTED_BASIN_GEO = null; // ÎšÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ GeoJSON Î³Î¹Î± ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚
  let map, lyr;

  // --- INIT ---
  async function init() {
    document.getElementById('loader').style.display = 'block';
    
    try {
       // 1. Fetch File Tree from GitHub
       const resp = await fetch(API_TREE);
       const data = await resp.json();
       if(data.message) throw new Error(data.message);
       
       const files = data.tree;

       // 2. Filter Basins (.geojson)
       BASINS = files.filter(f => f.path.includes('data/basins/') && f.path.endsWith('.geojson'));
       renderBasinList();

       // 3. Find Stations (stations.txt)
       const stationFile = files.find(f => f.path.includes('stations.txt'));
       if(stationFile) {
          fetchStations(stationFile.path);
       } else {
          updateMeteoStatus("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ stations.txt");
       }

    } catch(e) {
       console.error(e);
       updateMeteoStatus("Î£Ï†Î¬Î»Î¼Î± GitHub: " + e.message);
    } finally {
       document.getElementById('loader').style.display = 'none';
    }
  }

  // --- STATIONS LOGIC (Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ—) ---
  async function fetchStations(path) {
     try {
       const resp = await fetch(RAW_URL + path);
       const text = await resp.text();
       const lines = text.split('\n');
       const sel = document.getElementById('meteoStationSelect');
       sel.innerHTML = '<option value="">Î•Ï€Î¹Î»Î¿Î³Î® ÏƒÏ„Î±Î¸Î¼Î¿Ï...</option>';
       
       // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎŸÎ¼Î¬Î´Ï‰Î½ (OptGroups)
       const grpApi = document.createElement('optgroup'); grpApi.label = "API (Î›Î®ÏˆÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½)";
       const grpLink = document.createElement('optgroup'); grpLink.label = "Web Links (ÎœÏŒÎ½Î¿ Î ÏÎ¿Î²Î¿Î»Î®)";
       
       lines.forEach(line => {
          if(!line.trim()) return;
          
          let name = "";
          let url = line.trim();
          
          // Î ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· 1: Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î­Ï‡ÎµÎ¹ Î¼Î¿ÏÏ†Î® "ÎŒÎ½Î¿Î¼Î± | URL"
          if(line.includes('|')) {
             const parts = line.split('|');
             name = parts[0].trim();
             url = parts[1].trim();
          } 
          // Î ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· 2: Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î­Ï‡ÎµÎ¹ ÏƒÎºÎ­Ï„Î¿ URL
          else if(url.startsWith('http')) {
             try { 
                 // Î”Î™ÎŸÎ¡Î˜Î©Î£Î—: Î‘Ï†Î±Î¹ÏÎ¿ÏÎ¼Îµ Ï„Î·Î½ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± ÎºÎ¬Î¸ÎµÏ„Î¿ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
                 const cleanUrl = url.endsWith('/') ? url.slice(0, -1) : url;
                 // Î Î±Î¯ÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î¿ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹ ÎºÎ±Î¹ Ï„Î¿ ÎºÎ¬Î½Î¿Ï…Î¼Îµ ÎºÎµÏ†Î±Î»Î±Î¯Î¿
                 name = cleanUrl.split('/').pop().toUpperCase(); 
             } catch(e){
                 name = "Î‘Î“ÎÎ©Î£Î¤ÎŸÎ£ Î£Î¤Î‘Î˜ÎœÎŸÎ£";
             }
          }

          const opt = document.createElement('option');
          opt.value = url;
          opt.text = name;

          // ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ·
          if(url.includes('meteo.gr')) {
             grpApi.appendChild(opt);
          } else {
             grpLink.appendChild(opt);
          }
       });

       sel.appendChild(grpApi);
       sel.appendChild(grpLink);

     } catch(e) {
       console.error("Error stations", e);
     }
  }

  // ÎšÎ¿Ï…Î¼Ï€Î¯ "Web": Î‘Î½Î¿Î¯Î³ÎµÎ¹ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î± Î±Ï€ÏŒ Ï„Î¿ Î±Î½ Î´Î¯Î½ÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
  function openStationWeb() {
      const url = document.getElementById('meteoStationSelect').value;
      if(url && url.startsWith('http')) {
          window.open(url, '_blank');
      } else {
          alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î­Î½Î±Î½ ÏƒÏ„Î±Î¸Î¼ÏŒ Ï€ÏÏÏ„Î±.");
      }
  }

  // ÎšÎ¿Ï…Î¼Ï€Î¯ "Î›Î®ÏˆÎ· (API)" - Mockup Logic Î³Î¹Î± Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±
  async function fetchStationData() {
      const url = document.getElementById('meteoStationSelect').value;
      if(!url) { alert("Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏƒÏ„Î±Î¸Î¼ÏŒ"); return; }
      
      updateMeteoStatus("Î ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚...");
      
      // Mockup simulation Î³Î¹Î± demo
      if(url.includes('meteo.gr')) {
          setTimeout(() => {
              const mockRain = (Math.random() * 20).toFixed(1);
              document.getElementById('rainI').value = mockRain;
              updateMeteoStatus(`Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±! i=${mockRain} mm/h (Meteo.gr)`);
              calc();
          }, 800);
      } else {
          updateMeteoStatus("Î‘Î´Ï…Î½Î±Î¼Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ Î»Î®ÏˆÎ·Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ Ï„Î¿ Link. Î‘Î½Î¿Î¯Î¾Ï„Îµ Ï„Î¿ Web.");
      }
  }

  // --- OPEN METEO (FALLBACK) ---
  async function fetchLiveMeteo() {
      let lat = 38.02, lon = 23.80; 
      if (SELECTED_BASIN_GEO) {
          try {
             const coords = SELECTED_BASIN_GEO.features[0].geometry.coordinates[0][0];
             lon = coords[0]; lat = coords[1];
          } catch(e) {}
      }
      
      updateMeteoStatus(`Open-Meteo (${lat.toFixed(2)},${lon.toFixed(2)})...`);
      try {
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=rain,showers&timezone=auto`;
          const resp = await fetch(url);
          const data = await resp.json();
          const rain = data.current.rain + data.current.showers;
          
          document.getElementById('rainI').value = rain.toFixed(1);
          updateMeteoStatus(`Open-Meteo: ${rain} mm/h (Î¤ÏÏÎ±)`);
          calc();
      } catch(e) {
          updateMeteoStatus("Î£Ï†Î¬Î»Î¼Î± API: " + e.message);
      }
  }

  function updateMeteoStatus(msg) {
      document.getElementById('meteoStatus').innerText = msg;
  }

  // --- BASIN LIST ---
  function renderBasinList() {
     const tbody = document.getElementById('basinRows');
     tbody.innerHTML = '';
     BASINS.forEach(b => {
        const name = b.path.split('/').pop().replace('.geojson','');
        const tr = document.createElement('tr');
        tr.innerHTML = `
           <td style="text-align:left; font-weight:bold;">${name}</td>
           <td><span id="badge_${name}" style="background:#eee; padding:2px 5px; border-radius:4px; font-size:9px;">-</span></td>
           <td>
             <button class="mini-btn btn-load" onclick="loadBasin('${b.path}', '${name}')">Load</button>
             <button class="mini-btn btn-map" onclick="showMap('${b.path}')">Map</button>
           </td>
        `;
        tbody.appendChild(tr);
     });
  }

  async function loadBasin(path, id) {
     updateMeteoStatus("Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î»ÎµÎºÎ¬Î½Î·Ï‚...");
     const resp = await fetch(RAW_URL + path);
     const json = await resp.json();
     SELECTED_BASIN_GEO = json; 
     
     // Parse Properties
     const p = json.features && json.features[0] ? json.features[0].properties : {};
     if(p.area) document.getElementById('area').value = p.area;
     if(p.length) document.getElementById('length').value = p.length;
     if(p.height) document.getElementById('height').value = p.height;
     if(p.coef) document.getElementById('coef').value = p.coef;
     
     updateMeteoStatus(`Î¦Î¿ÏÏ„ÏÎ¸Î·ÎºÎµ: ${id}`);
     calc();
  }

  // --- CALCULATION ENGINE ---
  function calc() {
     const I = parseFloat(document.getElementById('rainI').value)||0;
     const A = parseFloat(document.getElementById('area').value)||0;
     const L = parseFloat(document.getElementById('length').value)||0;
     const H = parseFloat(document.getElementById('height').value)||0;
     const C = parseFloat(document.getElementById('coef').value)||0;
     
     // 1. Rational Method
     const Akm2 = A / 1e6;
     const Qpeak = 0.278 * C * I * Akm2;
     
     // 2. Tc (Kirpich)
     let Tc = 0;
     if(L > 0 && H > 0) {
        const S = H / L;
        Tc = 0.0195 * Math.pow(L, 0.77) * Math.pow(S, -0.385);
     }
     
     // 3. Manning (Qcap)
     const b = parseFloat(document.getElementById('strWidth').value)||0;
     const h_depth = parseFloat(document.getElementById('strDepth').value)||0;
     const n = parseFloat(document.getElementById('strN').value)||0.03;
     let Qcap = 0;
     if(b>0 && h_depth>0 && L>0 && H>0) {
         const S_slp = H/L;
         const A_sec = b * h_depth;
         const P = b + 2*h_depth;
         const R = A_sec / P;
         Qcap = (1/n) * A_sec * Math.pow(R, 2/3) * Math.sqrt(S_slp);
     }

     // Render
     document.getElementById('res-qsel').innerText = Qpeak.toFixed(2) + " mÂ³/s";
     document.getElementById('res-cap').innerText = Qcap.toFixed(2) + " mÂ³/s";
     document.getElementById('res-tc').innerText = Tc.toFixed(1) + " min";
     
     const stat = document.getElementById('res-status');
     if(Qpeak > 0 && Qcap > 0) {
         if(Qpeak < Qcap) { stat.innerHTML = "<span style='color:green'>OK</span>"; }
         else { stat.innerHTML = "<span style='color:red; font-weight:bold;'>ÎšÎ™ÎÎ”Î¥ÎÎŸÎ£</span>"; }
     } else {
         stat.innerText = "â€”";
     }
  }

  // --- MAP ---
  async function showMap(path) {
     const modal = document.getElementById('mapModal');
     modal.style.display = 'flex';
     
     if(!map) {
       map = L.map('mapBox').setView([38.02, 23.80], 13);
       L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
     } else {
       map.invalidateSize();
     }
     
     if(lyr) lyr.remove();
     
     const resp = await fetch(RAW_URL + path);
     const json = await resp.json();
     lyr = L.geoJSON(json).addTo(map);
     map.fitBounds(lyr.getBounds());
  }
  
  function togglePanel() {
      const b = document.getElementById('basinPanelBody');
      b.style.display = b.style.display === 'none' ? 'block' : 'none';
  }

  window.onload = init;
</script>
</body>
</html>
